@model Chaos.Wedding.Models.Games.Contract.Game

@{
    ViewBag.Title = "EditGame";
    Layout = "~/Views/Shared/_AppLayout.cshtml";
}

<div class="games-backward">
    <a href="@Url.Action("EditIndex", "Game")">
        <i class="fas fa-backward clickable success"></i>
    </a>
</div>

<div class="game-edit-row">
    <div>
        <h2>@Model.Titles.UserTitle.Title (@Model.Titles.UserTitle.Language.Name)</h2>
    </div>
    <div class="game-title-menu">
        <i class="far fa-save clickable success" onclick="saveGame()" title="Spara"></i>
    </div>
</div>

<h3>Titles</h3>
<div id="Titles">
    @foreach (var title in (List<string>)Session["Languages"])
    {
        var existingTitle = Model.Titles.FirstOrDefault(t => t.Language.Name == title);
        <div class="game-edit-row">
            <div>
                <div class="game-edit-columnHeader">Language</div>
                <input type="text" id='@FormattableString.Invariant($"Language_{title}")' value="@title" disabled="disabled" />
            </div>
            <div>
                <div class="game-edit-columnHeader">Title</div>
                <input type="text" id='@FormattableString.Invariant($"Title_{title}")' value="@(existingTitle?.Title)" />
            </div>
            <div>
                <div class="game-edit-columnHeader">Description</div>
                <input type="text" id='@FormattableString.Invariant($"Description_{title}")' value="@(existingTitle?.Description)" />
            </div>
        </div>
    }
</div>

<h3>Image</h3>
<div class="game-edit-row">
    <div>
        <input type="text" id="ImageId" value="@Model.ImageId" class="input-wide" />
    </div>
</div>

<h3>Width</h3>
<div class="game-edit-row">
    <div>
        <input type="text" id="Width" value="@Model.Width" />
    </div>
</div>

<h3>Height</h3>
<div class="game-edit-row">
    <div>
        <input type="text" id="Height" value="@Model.Height" />
    </div>
</div>

<h3>Zones</h3>
@foreach (var zone in Model.Zones)
{
    <div class="game-edit-row">
        <div class="game-edit-title">@zone.Titles.UserTitle.Title (@zone.Titles.UserTitle.Language.Name)</div>
        <div>
            <a href="@Url.Action("EditZone", "Game", new { zoneId = zone.Id, gameId = Model.Id })">
                <i class="fas fa-pen" title="Edit zone"></i>
            </a>
        </div>
    </div>
}

@if (Model.Id > 0)
{
    <div class="game-edit-row">
        <a href="@Url.Action("EditZone", "Game", new { zoneId = 0, gameId = Model.Id })">
            <i class="fas fa-plus" title="Add zone"></i>
        </a>
    </div>
}

<script type="text/javascript">
    function saveGame() {
        try {
            var gameId = @Model.Id;
            var imageId = document.getElementById("ImageId").value;
            var width = document.getElementById("Width").value;
            var height = document.getElementById("Height").value;
            var titles = "";

            var titleInputs = document.getElementById("Titles").getElementsByTagName("input");
            for (var i = 0; i < titleInputs.length; i++) {
                var language = titleInputs[i].value;
                var title = titleInputs[i + 1].value;
                var description = titleInputs[i + 2].value;
                i++;
                i++;
                if (title) {
                    titles += language + "¤" + title + "¤" + description + "|";
                }
            }

            var url = "@Url.Action("SaveGame", "Game")";
            var data = { gameId: gameId, imageId: imageId, width: width, height: height, titles: titles };
            gamesCallAjax(url, data);
        } catch (e) {
            window.notification("danger", e, "", 60000);
        }
    }
</script>